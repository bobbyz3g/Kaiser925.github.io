

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Bobby Zhang">
  <meta name="keywords" content="">
  
    <meta name="description" content="即将发布的 Go 1.18 将会带来一个巨大的更新：泛型。  官方教程：https:&#x2F;&#x2F;go.dev&#x2F;doc&#x2F;tutorial&#x2F;generics  这篇文章是对官方指引的翻译。 准备在正式尝试泛型之前，需要做如下的工作  安装 go1.18beta1 或更新的版本。安装方式请看 beta版本的安装与使用 一个可以编辑代码的编辑器，任何你喜欢的编辑器都可以 命令行终端，在 Linux 和 mac 上">
<meta property="og:type" content="article">
<meta property="og:title" content="Go 泛型预览">
<meta property="og:url" content="https://blog.zhangliangliang.cc/post/go-generics.html">
<meta property="og:site_name" content="bobbyz3g&#39;s blogs.">
<meta property="og:description" content="即将发布的 Go 1.18 将会带来一个巨大的更新：泛型。  官方教程：https:&#x2F;&#x2F;go.dev&#x2F;doc&#x2F;tutorial&#x2F;generics  这篇文章是对官方指引的翻译。 准备在正式尝试泛型之前，需要做如下的工作  安装 go1.18beta1 或更新的版本。安装方式请看 beta版本的安装与使用 一个可以编辑代码的编辑器，任何你喜欢的编辑器都可以 命令行终端，在 Linux 和 mac 上">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-17T08:47:50.000Z">
<meta property="article:modified_time" content="2025-08-13T09:50:52.910Z">
<meta property="article:author" content="Bobby Zhang">
<meta property="article:tag" content="Go">
<meta property="article:tag" content="泛型">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Go 泛型预览 - bobbyz3g&#39;s blogs.</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />

  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.zhangliangliang.cc","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"gtag":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>bobbyz3g</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://wallpaper.kaiser925.workers.dev') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Go 泛型预览"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-02-17 16:47" pubdate>
          2022年2月17日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          3.1k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          10 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Go 泛型预览</h1>
            
            
              <div class="markdown-body">
                
                <p>即将发布的 Go 1.18 将会带来一个巨大的更新：泛型。</p>
<blockquote>
<p>官方教程：<a target="_blank" rel="noopener" href="https://go.dev/doc/tutorial/generics">https://go.dev/doc/tutorial/generics</a></p>
</blockquote>
<p>这篇文章是对官方指引的翻译。</p>
<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>在正式尝试泛型之前，需要做如下的工作</p>
<ol>
<li>安装 go1.18beta1 或更新的版本。安装方式请看 beta版本的安装与使用</li>
<li>一个可以编辑代码的编辑器，任何你喜欢的编辑器都可以</li>
<li>命令行终端，在 Linux 和 mac 上可以使用自带的 terminal，在 Windows 上可以使用 powershell 或者 cmd</li>
</ol>
<h4 id="安装并使用测试版-Go-工具链"><a href="#安装并使用测试版-Go-工具链" class="headerlink" title="安装并使用测试版 Go 工具链"></a>安装并使用测试版 Go 工具链</h4><p>由于 Go1.18 还未正式发布，因此我们需要安装测试版工具链来尝鲜，按照如下的步骤来安装：</p>
<ol>
<li><p>运行下面的命令来安装测试版</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go install golang.org/dl/go1.18beta2@latest</span><br></code></pre></td></tr></table></figure></li>
<li><p>运行下面的命令来下载更新</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go1.18beta2 download</span><br></code></pre></td></tr></table></figure></li>
<li><p>使用测试版本程序取代原有的 go 命令（如果安装了正式版的 go）</p>
<p>可以直接使用测试版的名字，或者将 <code>go</code>设置为测试版程序的别名</p>
<ul>
<li><p>直接使用测试版，你可以运行下面的命令来调用测试版程序来取代 <code>go</code> 命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go1.18beta2 version</span><br></code></pre></td></tr></table></figure></li>
<li><p>将 <code>go</code>设置为别名，可以让测试版的使用更加简单</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">alias</span> go=go1.18beta2</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">go version</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<p>之后的命令将会默认你已经设置了别名</p>
<h3 id="创建一个代码文件夹"><a href="#创建一个代码文件夹" class="headerlink" title="创建一个代码文件夹"></a>创建一个代码文件夹</h3><p>首先需要一个文件夹来存放测试代码</p>
<ol>
<li><p>打开命令行，进入家目录</p>
<p>在 Linux 或者 Mac 上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span></span><br></code></pre></td></tr></table></figure>

<p>在 Windows 上</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">C:\&gt; <span class="hljs-title">cd</span> %<span class="hljs-title">HOMEPATH</span>%</span><br></code></pre></td></tr></table></figure>

<p>教程的其余部分将显示$作为提示。您使用的命令也可以在Windows上使用。</p>
</li>
<li><p>在命令行行中创建一个目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> generics</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> generics</span><br></code></pre></td></tr></table></figure></li>
<li><p>创建一个新的 Go module 来存放代码</p>
<p>运行<code>go mod init</code>命令，并给定模块的路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go mod init example/generics</span><br>go: creating new go.mod: module example/generics<br></code></pre></td></tr></table></figure>

<p><strong>注意:</strong> 对于生产代码, 你需要指定一个与你的需求更加契合的模块路径。更多信息可以参考 <a target="_blank" rel="noopener" href="https://go.dev/doc/modules/managing-dependencies">Managing dependencies</a>.</p>
</li>
</ol>
<p>接下来，你将会写一些简单的代码来接触泛型</p>
<h3 id="新增一个非泛型函数"><a href="#新增一个非泛型函数" class="headerlink" title="新增一个非泛型函数"></a>新增一个非泛型函数</h3><p>在这一步，你将会增加两个函数，每个函数都会将 map 中的值相加，然后返回最终的和。</p>
<p>之所以会定义两个函数，是因为有两种不同类型的 map 需要被处理：一种的值类型为 int64，另一种的值类型则是 float64.</p>
<h4 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h4><ol>
<li><p>用你的编辑器在目录下创建一个 <code>main.go</code>文件，你将会在这个文件中创建代码</p>
</li>
<li><p>在 main.go 文件的最顶部，粘贴下面的包声明语句</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br></code></pre></td></tr></table></figure>

<p>一个独立的可执行程序（而不是库）入口总是在 main 包中。</p>
</li>
<li><p>在包声明语句下方粘贴下面的函数代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// SumInts adds together the values of m.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumInts</span><span class="hljs-params">(m <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int64</span>)</span></span> <span class="hljs-type">int64</span> &#123;<br>    <span class="hljs-keyword">var</span> s <span class="hljs-type">int64</span><br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> m &#123;<br>        s += v<br>    &#125;<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br><br><span class="hljs-comment">// SumFloats adds together the values of m.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumFloats</span><span class="hljs-params">(m <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">float64</span>)</span></span> <span class="hljs-type">float64</span> &#123;<br>    <span class="hljs-keyword">var</span> s <span class="hljs-type">float64</span><br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> m &#123;<br>        s += v<br>    &#125;<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在上述的代码中，你做了如下的事：</p>
<ul>
<li>定义了两个函数，每个函数都会将 map 中的值相加，然后返回最终的和。<ul>
<li>SumInts 处理 string-int64 类型的 map</li>
<li>SumFloats 处理 string-float64 类型的 map</li>
</ul>
</li>
</ul>
</li>
<li><p>在 main.go 中，包声明语句的下方粘贴 main 方法的代码。在 main 方法中，会初始化两个 map，并且将它们作为参数传入在上一步中定义的方法内。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// Initialize a map for the integer values</span><br>    ints := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int64</span>&#123;<br>        <span class="hljs-string">&quot;first&quot;</span>:  <span class="hljs-number">34</span>,<br>        <span class="hljs-string">&quot;second&quot;</span>: <span class="hljs-number">12</span>,<br>    &#125;<br><br>    <span class="hljs-comment">// Initialize a map for the float values</span><br>    floats := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">float64</span>&#123;<br>        <span class="hljs-string">&quot;first&quot;</span>:  <span class="hljs-number">35.98</span>,<br>        <span class="hljs-string">&quot;second&quot;</span>: <span class="hljs-number">26.99</span>,<br>    &#125;<br><br>    fmt.Printf(<span class="hljs-string">&quot;Non-Generic Sums: %v and %v\n&quot;</span>,<br>        SumInts(ints),<br>        SumFloats(floats))<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在上面的代码中，做了如下的事情：</p>
<ul>
<li>初始化了值类型为 float64 的 map 和值类型为 int64 的 map，每个 map 都有两个元素</li>
<li>调用上一步定义的函数来获取每个 map 中的值的和</li>
<li>将结果打印出来</li>
</ul>
</li>
<li><p>在 main.go 中，就在包定义语句的下方，导入刚刚书写的代码中所需要的包。</p>
<p>第一行代码应该如下所示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">pacakge main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br></code></pre></td></tr></table></figure></li>
<li><p>保存 main.go</p>
</li>
</ol>
<h4 id="运行代码"><a href="#运行代码" class="headerlink" title="运行代码"></a>运行代码</h4><p>在包含 main.go 的目录中的命令行中，运行代码:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go run .</span><br>Non-Generic Sums: 46 and 62.97<br></code></pre></td></tr></table></figure>

<p>通过使用泛型，你可以使用一个函数来完成需求。在接下来的步骤中，将会添加一个函数来处理值类型为 int64 或 float64 的 map。</p>
<h3 id="新增一个泛型函数来处理多种类型"><a href="#新增一个泛型函数来处理多种类型" class="headerlink" title="新增一个泛型函数来处理多种类型"></a>新增一个泛型函数来处理多种类型</h3><p>在这一节，你将会添加一个泛型函数，它接受值类型为 float64 或 int64 的 map 作为参数，使用单个函数就可以高效的替换原有的两个函数。</p>
<p>为了支持任一类型的值，这个函数需要一种方法来声明它支持的类型。另一方面，函数的调用者需要一种方法来指定传入的 map 是float64 还是 int64 的。</p>
<p>为了支持这一点，你将编写一个函数，除了普通的函数参数外，还会声明<em>类型参数</em>。这些类型参数使函数具有通用性（泛型），使其能够处理不同类型的参数。你将使用类型参数和普通函数参数调用函数。</p>
<p>每个参数类型都有着一个<em>类型约束</em>（<em>type constraint</em> ），作为参数类型的元类型（meta-type）。每个类型约束都指定了，在调用函数时所允许传入的参数类型。</p>
<p>虽然类型约束通常代表了一组类型，但在编译时，类型参数代表了单个类型——函数调用者提供的参数类型的类型。如果类型参数的类型不符合类型约束，那么代码将无法编译。</p>
<p>请记住，类型参数必须支持泛型代码在该类型上执行的所有操作。例如，如果函数的代码试图对约束包含 int 类型参数执行 string 操作（如 strings.Index ），那么代码将无法通过编译。</p>
<p>在即将编写的代码中，你将会使用允许 int 以及 float 的类型约束。</p>
<h4 id="编写代码-1"><a href="#编写代码-1" class="headerlink" title="编写代码"></a>编写代码</h4><ol>
<li><p>在上一节新增的代码下方，粘贴泛型函数的代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// SumIntsOrFloats sums the values of map m. It supports both int64 and float64</span><br><span class="hljs-comment">// as types for map values.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumIntsOrFloats</span>[<span class="hljs-title">K</span> <span class="hljs-title">comparable</span>, <span class="hljs-title">V</span> <span class="hljs-title">int64</span> | <span class="hljs-title">float64</span>]<span class="hljs-params">(m <span class="hljs-keyword">map</span>[K]V)</span></span> V &#123;<br>    <span class="hljs-keyword">var</span> s V<br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> m &#123;<br>        s += v<br>    &#125;<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在这段代码中：</p>
<ul>
<li>定义了 SumIntsOrFloats 函数，该函数包含了两个类型参数（在方括号中）K 和 V，以及一个类型为 map[K]V 的参数 m。函数的返回值类型为 V</li>
<li>指定 K 的类型约束为 comparable。 comparable 是 go 预设的一个类型约束。它允许任何满足约束的类型的值都可以用作比较运算符 == 和  !=。这是因为在 Go 中 map 的 key 的类型必须是可比较的。因此将 K 设为 comparable 就是非常必要的了，你可以使用 K 来作为 map 的key。同时保证了调用者只使用被允许的类型的 key。</li>
<li>指定 V 的类型约束为 int64 和 float64 两种类型的联合类型。使用操作符｜指定两种类型的联合类型，表示该约束允许其中的任意一种类型。编译器允许这两种类型作为参数的类型传入函数。</li>
<li>指定了 m 的类型为 map[K]V，K，V 的类型已经被类型参数所指定了。需要注意的是， map[K]V 是一个合法的 map 类型，因为K 已经被声明为 comparable 了。如果没有将 K 声明为 comparable，编译器将拒绝 map[K]V 的使用</li>
</ul>
</li>
<li><p>在 main.go 中，粘贴下面的代码到原有代码的下方</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">fmt.Printf(<span class="hljs-string">&quot;Generic Sums: %v and %v\n&quot;</span>,<br>    SumIntsOrFloats[<span class="hljs-type">string</span>, <span class="hljs-type">int64</span>](ints),<br>    SumIntsOrFloats[<span class="hljs-type">string</span>, <span class="hljs-type">float64</span>](floats))<br></code></pre></td></tr></table></figure>

<p>在这段代码中：</p>
<ul>
<li><p>调用了刚才定义的泛型函数，传入了创建的 map</p>
</li>
<li><p>指定了类型参数 –  包含在方括号中的类型的名称 - 表明在调用时需要被替换的类型参数的类型</p>
<p>正如下一节中看到的，通常可以在函数调用中省略类型参数。Go编译器通常可以从你的代码中推断它们。</p>
</li>
<li><p>打印函数的返回值</p>
</li>
</ul>
</li>
</ol>
<h4 id="运行代码-1"><a href="#运行代码-1" class="headerlink" title="运行代码"></a>运行代码</h4><p>在包含 main.go 的目录中的命令行中，运行代码:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go run .</span><br>Non-Generic Sums: 46 and 62.97<br>Generic Sums: 46 and 62.97<br></code></pre></td></tr></table></figure>

<p>要运行代码，在每次调用中，编译器都会将类型参数替换为该调用中指定的具体类型。</p>
<p>在调用泛型函数时，通过指定类型参数，来告诉编译器使用哪些类型来代替函数的类型参数。</p>
<h3 id="在调用泛型函数时移除类型参数"><a href="#在调用泛型函数时移除类型参数" class="headerlink" title="在调用泛型函数时移除类型参数"></a>在调用泛型函数时移除类型参数</h3><p>在本节中，你将添加泛型函数调用的修改版本，进行小幅更改以简化调用代码。将会删除类型参数，在这种情况下，这些参数不需要。</p>
<p>当Go编译器可以推断要使用的类型时，可以在调用代码时省略类型参数。编译器从函数参数的类型中推断类型参数。</p>
<p>请注意，这并不总是可行的。例如，如果在需要调用没有参数的泛型函数时，需要在函数调用中包含类型参数。</p>
<h4 id="编写代码-2"><a href="#编写代码-2" class="headerlink" title="编写代码"></a>编写代码</h4><ul>
<li><p>在 main.go 中，粘贴下面的代码到原有代码的下方</p>
 <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">fmt.Printf(<span class="hljs-string">&quot;Generic Sums, type parameters inferred: %v and %v\n&quot;</span>,<br>    SumIntsOrFloats(ints),<br>    SumIntsOrFloats(floats))<br></code></pre></td></tr></table></figure>
<p> 在这段代码中：</p>
<ul>
<li>调用了泛型函数，并省略了类型参数</li>
</ul>
</li>
</ul>
<h4 id="运行代码-2"><a href="#运行代码-2" class="headerlink" title="运行代码"></a>运行代码</h4><p>在包含 main.go 的目录中的命令行中，运行代码:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go run .</span><br>Non-Generic Sums: 46 and 62.97<br>Generic Sums: 46 and 62.97<br>Generic Sums, type parameters inferred: 46 and 62.97<br></code></pre></td></tr></table></figure>

<p>接下来，你会定义一个可以重用的类型约束，该约束的类型为整数和浮点的联和类型，通过在代码中使用该约束来进一步简化代码。</p>
<h3 id="定义类型约束"><a href="#定义类型约束" class="headerlink" title="定义类型约束"></a>定义类型约束</h3><p>在最后这一节，你将会把之前定义的约束放进它自己的 interface 中，这样的话就可以在不同的地方重用它了。以这种方式声明约束有助于简化代码，例如当约束更复杂时。</p>
<p>你可以将类型约束定义为一个 interface。约束允许任何类型去实现接口。例如，声明了一个具有三种方法的类型约束接口，然后将其与泛型函数中的类型参数一起使用，则用于调用函数的类型参数必须具有所有的这些方法。</p>
<p>约束接口也可以引用特定类型，您将在本节中看到。</p>
<h4 id="编写代码-3"><a href="#编写代码-3" class="headerlink" title="编写代码"></a>编写代码</h4><ol>
<li><p>就在 main 函数的上方，在导入语句之后，粘贴以下代码以声明类型约束。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Number <span class="hljs-keyword">interface</span> &#123;<br>    <span class="hljs-type">int64</span> | <span class="hljs-type">float64</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>在这段代码中：</p>
<ul>
<li><p>声明要用作类型约束的Number接口类型。</p>
</li>
<li><p>在接口内部声明了 int64 | float64 的联合类型。</p>
<p>本质上，是将联合类型从函数声明移动到新的类型约束中。这样，当你想将类型参数限制为int64或float64时，就可以使用此Number 类型约束，而不是写出 int64 ｜float64。</p>
</li>
</ul>
</li>
<li><p>在原有函数的下方，粘贴下面的代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// SumNumbers sums the values of map m. It supports both integers</span><br><span class="hljs-comment">// and floats as map values.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumNumbers</span>[<span class="hljs-title">K</span> <span class="hljs-title">comparable</span>, <span class="hljs-title">V</span> <span class="hljs-title">Number</span>]<span class="hljs-params">(m <span class="hljs-keyword">map</span>[K]V)</span></span> V &#123;<br>    <span class="hljs-keyword">var</span> s V<br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> m &#123;<br>        s += v<br>    &#125;<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在这段代码中：</p>
<ul>
<li>以与之前声明的泛型函数相同的逻辑声明泛型函数，但使用新的接口类型而不是联合作为类型约束。和之前前一样，使用参数和返回类型的类型参数</li>
</ul>
</li>
<li><p>在 main.go 中，原有代码的下方，粘贴下列代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">fmt.Printf(<span class="hljs-string">&quot;Generic Sums with Constraint: %v and %v\n&quot;</span>,<br>    SumNumbers(ints),<br>    SumNumbers(floats))<br></code></pre></td></tr></table></figure>

<p>在这段代码中：</p>
<ul>
<li><p>对每个 map 调用 SumNumbers，并打印每个结果。</p>
<p>与上一节一样，在对泛型函数的调用中省略了类型参数（方括号内的类型名称）。Go编译器可以从其他参数推断类型参数。</p>
</li>
</ul>
</li>
</ol>
<h4 id="运行代码-3"><a href="#运行代码-3" class="headerlink" title="运行代码"></a>运行代码</h4><p>在包含 main.go 的目录中的命令行中，运行代码:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go run .</span><br>Non-Generic Sums: 46 and 62.97<br>Generic Sums: 46 and 62.97<br>Generic Sums, type parameters inferred: 46 and 62.97<br>Generic Sums with Constraint: 46 and 62.97<br></code></pre></td></tr></table></figure>

<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> Number <span class="hljs-keyword">interface</span> &#123;<br>    <span class="hljs-type">int64</span> | <span class="hljs-type">float64</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// Initialize a map for the integer values</span><br>    ints := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int64</span>&#123;<br>        <span class="hljs-string">&quot;first&quot;</span>: <span class="hljs-number">34</span>,<br>        <span class="hljs-string">&quot;second&quot;</span>: <span class="hljs-number">12</span>,<br>    &#125;<br><br>    <span class="hljs-comment">// Initialize a map for the float values</span><br>    floats := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">float64</span>&#123;<br>        <span class="hljs-string">&quot;first&quot;</span>: <span class="hljs-number">35.98</span>,<br>        <span class="hljs-string">&quot;second&quot;</span>: <span class="hljs-number">26.99</span>,<br>    &#125;<br><br>    fmt.Printf(<span class="hljs-string">&quot;Non-Generic Sums: %v and %v\n&quot;</span>,<br>        SumInts(ints),<br>        SumFloats(floats))<br><br>    fmt.Printf(<span class="hljs-string">&quot;Generic Sums: %v and %v\n&quot;</span>,<br>        SumIntsOrFloats[<span class="hljs-type">string</span>, <span class="hljs-type">int64</span>](ints),<br>        SumIntsOrFloats[<span class="hljs-type">string</span>, <span class="hljs-type">float64</span>](floats))<br><br>    fmt.Printf(<span class="hljs-string">&quot;Generic Sums, type parameters inferred: %v and %v\n&quot;</span>,<br>        SumIntsOrFloats(ints),<br>        SumIntsOrFloats(floats))<br><br>    fmt.Printf(<span class="hljs-string">&quot;Generic Sums with Constraint: %v and %v\n&quot;</span>,<br>        SumNumbers(ints),<br>        SumNumbers(floats))<br>&#125;<br><br><span class="hljs-comment">// SumInts adds together the values of m.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumInts</span><span class="hljs-params">(m <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int64</span>)</span></span> <span class="hljs-type">int64</span> &#123;<br>    <span class="hljs-keyword">var</span> s <span class="hljs-type">int64</span><br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> m &#123;<br>        s += v<br>    &#125;<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br><br><span class="hljs-comment">// SumFloats adds together the values of m.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumFloats</span><span class="hljs-params">(m <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">float64</span>)</span></span> <span class="hljs-type">float64</span> &#123;<br>    <span class="hljs-keyword">var</span> s <span class="hljs-type">float64</span><br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> m &#123;<br>        s += v<br>    &#125;<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br><br><span class="hljs-comment">// SumIntsOrFloats sums the values of map m. It supports both floats and integers</span><br><span class="hljs-comment">// as map values.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumIntsOrFloats</span>[<span class="hljs-title">K</span> <span class="hljs-title">comparable</span>, <span class="hljs-title">V</span> <span class="hljs-title">int64</span> | <span class="hljs-title">float64</span>]<span class="hljs-params">(m <span class="hljs-keyword">map</span>[K]V)</span></span> V &#123;<br>    <span class="hljs-keyword">var</span> s V<br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> m &#123;<br>        s += v<br>    &#125;<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br><br><span class="hljs-comment">// SumNumbers sums the values of map m. Its supports both integers</span><br><span class="hljs-comment">// and floats as map values.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumNumbers</span>[<span class="hljs-title">K</span> <span class="hljs-title">comparable</span>, <span class="hljs-title">V</span> <span class="hljs-title">Number</span>]<span class="hljs-params">(m <span class="hljs-keyword">map</span>[K]V)</span></span> V &#123;<br>    <span class="hljs-keyword">var</span> s V<br>    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> m &#123;<br>        s += v<br>    &#125;<br>    <span class="hljs-keyword">return</span> s<br>&#125;<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Go/" class="print-no-link">#Go</a>
      
        <a href="/tags/%E6%B3%9B%E5%9E%8B/" class="print-no-link">#泛型</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Go 泛型预览</div>
      <div>https://blog.zhangliangliang.cc/post/go-generics.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Bobby Zhang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年2月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/post/binary-search.html" title="二分查找">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">二分查找</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/post/cloudflare-wallpaper-server.html" title="使用Cloudflare worker搭建壁纸服务">
                        <span class="hidden-mobile">使用Cloudflare worker搭建壁纸服务</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
